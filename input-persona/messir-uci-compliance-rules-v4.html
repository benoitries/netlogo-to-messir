<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>messir-uci-compliance-rules-v4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="messir-uci-compliance-rules-v4_files/libs/clipboard/clipboard.min.js"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/popper.min.js"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="messir-uci-compliance-rules-v4_files/libs/quarto-html/anchor.min.js"></script>
<link href="messir-uci-compliance-rules-v4_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="messir-uci-compliance-rules-v4_files/libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="messir-uci-compliance-rules-v4_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="messir-uci-compliance-rules-v4_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="messir-uci-compliance-rules-v4_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="mucim-dsl-messir-use-case-instance-domain-specific-language" class="level1">
<h1>MUCIM DSL — Messir Use-Case Instance Domain-Specific Language</h1>
<section id="scope-and-audience-informative" class="level2">
<h2 class="anchored" data-anchor-id="scope-and-audience-informative">1. Scope and Audience (Informative)</h2>
<section id="background" class="level3">
<h3 class="anchored" data-anchor-id="background">1.1 Background</h3>
<p>Messir is a model-driven methodology and family of domain-specific modeling languages (DSMLs) covering requirements, analysis, design, test, and validation phases. It builds on UML and OCL to provide precise, verifiable specifications of reactive systems. Messir emphasizes scenario-driven modeling (actors, system, events, constraints) and traceability from requirements to validation artifacts. Within this family, the MUCIM DSL captures single use-case instances as constrained UML Sequence Diagrams, enforcing a system-centered interaction discipline (Actor↔︎System only) and well-formedness rules suitable for automated validation and documentation.</p>
</section>
<section id="purpose" class="level3">
<h3 class="anchored" data-anchor-id="purpose">1.2 Purpose</h3>
<p>Define the MUCIM (Messir Use-Case Instance Model) DSL as a constrained subset of UML Sequence Diagrams for modeling system–actor interactions in reactive system scenarios.</p>
</section>
<section id="audience" class="level3">
<h3 class="anchored" data-anchor-id="audience">1.3 Audience</h3>
<p>MUCIM modelers, business stakeholders, model validators, requirements engineers, and tool builders.</p>
</section>
<section id="in-scope" class="level3">
<h3 class="anchored" data-anchor-id="in-scope">1.4 In-Scope</h3>
<ul>
<li>Constrained UML Sequence Diagrams for single use-case instances</li>
<li>Actor↔︎System interactions only</li>
<li>Deterministic, tool-checkable rules for validation and documentation</li>
</ul>
</section>
<section id="non-goals-out-of-scope" class="level3">
<h3 class="anchored" data-anchor-id="non-goals-out-of-scope">1.5 Non-Goals / Out-of-Scope</h3>
<ul>
<li>General-purpose sequence diagram modeling</li>
<li>Performance or scalability modeling</li>
<li>Multi-system interactions</li>
<li>Asynchronous or parallel execution modeling</li>
</ul>
</section>
<section id="assumptions" class="level3">
<h3 class="anchored" data-anchor-id="assumptions">1.6 Assumptions</h3>
<ul>
<li>Single reactive system with external actors</li>
<li>Linear temporal ordering of interactions</li>
<li>PlantUML is the primary concrete syntax</li>
</ul>
</section>
<section id="terminology-and-notation-conventions" class="level3">
<h3 class="anchored" data-anchor-id="terminology-and-notation-conventions">1.7 Terminology and Notation Conventions</h3>
<p>Terminology aligns with UML and Messir. See the Glossary for definitions and abbreviations.</p>
</section>
<section id="mde-level-note-m2-vs-m1" class="level3">
<h3 class="anchored" data-anchor-id="mde-level-note-m2-vs-m1">1.8 MDE Level Note (M2 vs M1)</h3>
<p>This document separates metamodel-level constraints (M2, Abstract Syntax and Static Semantics) from model-level constraints (M1, Concrete Syntax and Naming/Style). Normative AS/SS rules belong to M2. Normative CS/NAM rules belong to M1. Examples and glossary are informative.</p>
</section>
</section>
<section id="normative-overview" class="level2">
<h2 class="anchored" data-anchor-id="normative-overview">2. Normative Overview</h2>
<section id="dsl-identity" class="level3">
<h3 class="anchored" data-anchor-id="dsl-identity">2.1 DSL Identity</h3>
<ul>
<li>Base language: UML Sequence Diagram</li>
<li>Extension mechanism: UML subsetting with well-formedness constraints</li>
<li>Rationale: Maximize tool interoperability while enforcing domain-specific constraints</li>
</ul>
</section>
<section id="conformance-levels" class="level3">
<h3 class="anchored" data-anchor-id="conformance-levels">2.2 Conformance Levels</h3>
<ul>
<li>L1 Abstract Syntax: ASx compliance (model structure)</li>
<li>L2 Static Semantics: SSx compliance (well-formedness)</li>
<li>L3 Concrete Syntax: TCSx/GCSx compliance (PlantUML rendering)</li>
<li>L4 Style: NAMx compliance (advisory)</li>
</ul>
</section>
<section id="validation-severity" class="level3">
<h3 class="anchored" data-anchor-id="validation-severity">2.3 Validation Severity</h3>
<ul>
<li>Error: Model rejected (AS/SS violations)</li>
<li>Warning: Style issues (NAM violations)</li>
<li>Info: Optimization suggestions</li>
</ul>
</section>
<section id="rule-identifier-scheme-and-stability" class="level3">
<h3 class="anchored" data-anchor-id="rule-identifier-scheme-and-stability">2.4 Rule Identifier Scheme and Stability</h3>
<p>Rule IDs are stable and unique: ASn and SSn (M2), TCSn and GCSn and NAMn (M1). Every validation message MUST reference the specific rule ID (e.g., AS1, SS2, TCS5, GCS2, NAM3).</p>
</section>
</section>
<section id="metamodel-level-m2-abstract-syntax-and-static-semantics-normative" class="level2">
<h2 class="anchored" data-anchor-id="metamodel-level-m2-abstract-syntax-and-static-semantics-normative">3. Metamodel Level (M2) — Abstract Syntax and Static Semantics (Normative)</h2>
<section id="abstract-syntax-as" class="level3">
<h3 class="anchored" data-anchor-id="abstract-syntax-as">3.1 Abstract Syntax (AS)</h3>
<section id="element-inventory" class="level4">
<h4 class="anchored" data-anchor-id="element-inventory">3.1.1 Element Inventory</h4>
<ul>
<li><code>Interaction</code>: Root container for the MUCIM model</li>
<li><code>Lifeline</code>: System and Actor participants</li>
<li><code>Message</code>: Actor↔︎System communications only</li>
<li><code>OccurrenceSpecification</code>: Message send/receive events</li>
<li><code>ExecutionSpecification</code>: Actor activation intervals</li>
</ul>
</section>
<section id="forbidden-uml-concepts" class="level4">
<h4 class="anchored" data-anchor-id="forbidden-uml-concepts">3.1.2 Forbidden UML Concepts</h4>
<ul>
<li><code>CombinedFragment</code>: No combined fragments</li>
<li><code>InteractionOperand</code>: No interaction operands</li>
<li><code>Constraint</code>: No constraint</li>
<li><code>InteractionUse</code>: No interaction references</li>
<li><code>StateInvariant</code>: No state constraints</li>
<li><code>Gate</code>: No interface gates</li>
<li><code>GeneralOrdering</code>: Temporal order is textual order</li>
<li><code>DestructionOccurrenceSpecification</code>: No object destruction</li>
<li><code>CreationEvent</code>: No object creation during interaction</li>
</ul>
</section>
<section id="mapping-to-uml-metamodel" class="level4">
<h4 class="anchored" data-anchor-id="mapping-to-uml-metamodel">3.1.3 Mapping to UML Metamodel</h4>
<ul>
<li>Scenario (SCE) → UML Interaction: exactly one per model, root container</li>
<li>System (SYS) → UML Lifeline: exactly one, named “System”</li>
<li>Actor (ACT) → UML Lifeline: not “System”; type matches <code>Act[A-Z][A-Za-z0-9]*</code></li>
<li>Output Event (OE) → UML Message: sender Actor, receiver System</li>
<li>Input Event (IE) → UML Message: sender System, receiver Actor</li>
<li>Activation Bar (AB) → UML ExecutionSpecification: only on Actors; no nesting/overlap; none on System</li>
<li>Event Parameter (EP) → UML ValueSpecification(s): ordered arguments on Messages</li>
</ul>
</section>
<section id="abstract-syntax-rules-as" class="level4">
<h4 class="anchored" data-anchor-id="abstract-syntax-rules-as">3.1.4 Abstract Syntax Rules (AS)</h4>
<p><strong>AS — System (SYS)</strong></p>
<p>AS1_SYS_UNIQUE. There must be exactly one System per model that is always named System</p>
<p>AS2_SYS_DECLARED_FIRST. The System must be declared first before all actors.</p>
<p>AS3_SYS_ACT_ALLOWED_EVENTS. Events must always be from System (resp. Actor) to an Actor (resp. the System). System → Actor or Actor → System Canonical semantics for message directionality is specified in SS1_MESSAGE_DIRECTIONALITY.</p>
<p>AS4_SYS_NO_SELF_LOOP. Events must never be from System to System. System → System Canonical semantics for message directionality is specified in SS1_OEIE_MESSAGE_DIRECTIONALITY.</p>
<p><strong>AS — Actors (ACT)</strong></p>
<p>AS5_ACT_DECLARED_AFTER_SYS. The actors must be declared after the System.</p>
<p>AS6_ACT_NO_ACT_ACT_EVENTS. Events must never be from Actor to Actor. Actor → Actor Canonical semantics for message directionality is specified in SS1_OEIE_MESSAGE_DIRECTIONALITY.</p>
<p>AS7_ACT_TYPE_FORMAT. Actor type name must be human-readable, in FirstCapitalLetterFormat and prefixed by “Act” Example 1 : ActMsrCreator Example 2 : ActEcologist</p>
<p><strong>AS — Input Events (IE)</strong></p>
<p>AS8_IE_EVENT_DIRECTION. System sends event TO actor (System → Actor) — Input Event FROM System TO actor Note. The “ie” prefix refers to the actor’s perspective, not the system’s perspective Canonical semantics for message directionality is specified in SS1_OEIE_MESSAGE_DIRECTIONALITY.</p>
<p><strong>AS — Output Events (OE)</strong></p>
<p>AS9_OE_EVENT_DIRECTION. Actor sends event TO System (Actor → System) — Output Event FROM actor TO System Note. The “oe” prefix refers to the actor’s perspective, not the system’s perspective Canonical semantics for message directionality is specified in SS1_OEIE_MESSAGE_DIRECTIONALITY.</p>
<p><strong>AS — Activation Bars (AB)</strong></p>
<p>AS10_AB_NO_NESTING. Activator bars must never be nested.</p>
<p>AS11_AB_ORDER. For each event, an activator bar must be defined that is always beginning just after the event. Activation bars must always be located on the side of the actor lifeline, never on the side of the System. See SS2_AB_PLACEMENT_ORDERING for the normative ordering and placement constraint.</p>
<p>AS12_AB_NO_OVERLAPPING. Activation bars must never overlap. Following sequence is forbidden: an event, start of activation bar of this event, another event before the end of the activation bar.</p>
</section>
</section>
<section id="static-semantics-ss" class="level3">
<h3 class="anchored" data-anchor-id="static-semantics-ss">3.2 Static Semantics (SS)</h3>
<p><strong>SS — Directionality (OE/IE)</strong></p>
<p>SS1_OEIE_MESSAGE_DIRECTIONALITY. Every message in a MUCIM interaction SHALL connect exactly one Actor lifeline and the unique System lifeline. Messages between two Actors and messages from System to System are FORBIDDEN.</p>
<p><strong>SS — Activation Bars (AB)</strong></p>
<p>SS2_AB_PLACEMENT_ORDERING. For each message, if an activation is used, it SHALL occur on the receiving Actor lifeline immediately after the message occurrence. No activations SHALL occur on the System lifeline. The activation SHALL start right after the message and SHALL end before any subsequent message that depends on its completion.</p>
<p><strong>SS — System (SYS)</strong></p>
<p>SS3_SYS_UNIQUE_IDENTITY. There SHALL be exactly one logical System lifeline in the interaction, and its canonical rendered name SHALL be “System”.</p>
</section>
<section id="rule-catalog-m2" class="level3">
<h3 class="anchored" data-anchor-id="rule-catalog-m2">3.3 Rule Catalog (M2)</h3>
<p>A machine- and human-readable catalog enumerating AS/SS rules with: ID, Title, Intent, Preconditions, Constraint, Examples (✓/✗), Severity, Scope (M2), Rationale, Notes. (To be provided/maintained alongside the rules.)</p>
</section>
</section>
<section id="model-level-m1-concrete-syntax-and-naming-normative" class="level2">
<h2 class="anchored" data-anchor-id="model-level-m1-concrete-syntax-and-naming-normative">4. Model Level (M1) — Concrete Syntax and Naming (Normative)</h2>
<section id="textual-concrete-syntax-tcs" class="level3">
<h3 class="anchored" data-anchor-id="textual-concrete-syntax-tcs">4.1 Textual Concrete Syntax (TCS)</h3>
<p><strong>TCS — Scenario (SCE)</strong></p>
<p>TCS1_SCE_MUCIM_REPRESENTATION. A Messir use case instance must be represented as a UML Sequence Diagram using strictly PlantUML textual syntax.</p>
<p>TCS2_SCE_ALLOW_BLANK_LINES. In PlantUML diagrams, blank lines may safely be ignored.</p>
<p><strong>TCS — System (SYS)</strong></p>
<p>TCS3_SYS_DECLARATION. Declare the System participant first using the syntax: participant System as system. See SS3_SYS_UNIQUE_IDENTITY for uniqueness and canonical naming.</p>
<p><strong>TCS — Input Events (IE)</strong></p>
<p>TCS4_IE_SYNTAX. All ie event names are prefixed with “ie”. ie event names may be generic. ie events must be modeled using dashed arrows and following this declaration syntax: system –&gt; theParticipant : ieMessageName(EP) Example 1 : system –&gt; jen : ieValidationFromTownHall() Example 2 : system –&gt; jen : ieMessage(“Congratulations jen for your 6-years mandate as a major of the town !”) Note: This section defines PlantUML textual syntax only. See SS1_OEIE_MESSAGE_DIRECTIONALITY for the normative message directionality constraint.</p>
<p><strong>TCS — Output Events (OE)</strong></p>
<p>TCS5_OE_SYNTAX. All oe event names are prefixed with “oe” oe event names may be generic. oe events must be modeled using continuous arrows and following this declaration syntax: the participant -&gt; system : oeMessage(EP) Example: alex -&gt; system : oeConstructionRequest(“hpc”) Note: This section defines PlantUML textual syntax only. See SS1_OEIE_MESSAGE_DIRECTIONALITY for the normative message directionality constraint.</p>
<p><strong>TCS — Event Parameters (EP)</strong></p>
<p>TCS6_EP_TYPE. Event parameters format may be of any type.</p>
<p>TCS7_EP_FLEX_QUOTING. Each event parameter may be surrounded by single-quote (’) OR double-quote (“) OR no quote at all. A mix of single-quote, double-quote, no quote IS allowed within a parameter list.</p>
<p>TCS8_EP_COMMA_SEPARATED. Multiple parameters must be comma-separated.</p>
<p><strong>TCS — Activation Bars (AB)</strong></p>
<p>TCS9_AB_SEQUENCE. Strictly follow this sequence of instructions for activation bars declarations: (1) an event declaration (2) activate the participant related to the event (3) deactive the participant related to the event Procedural guidance for PlantUML; the normative ordering is defined by SS2_AB_PLACEMENT_ORDERING.</p>
<p>TCS10_AB_NO_ACTIVATION_BAR_ON_SYSTEM. There must be NO activation bar in the System lifeline. Never activate System. Activation bar colors are specified in GCS (Section 4.2).</p>
</section>
<section id="graphical-concrete-syntax-gcs" class="level3">
<h3 class="anchored" data-anchor-id="graphical-concrete-syntax-gcs">4.2 Graphical Concrete Syntax (GCS)</h3>
<p><strong>GCS — System (SYS)</strong></p>
<p>GCS1_SYS_PARTICIPANT_RECTANGLE. System must be declared as a PlantUML participant, with a rectangle shape.</p>
<p>GCS2_SYS_COLOR. The System rectangle background must be #E8C28A</p>
<p><strong>GCS — Actors (ACT)</strong></p>
<p>GCS3_ACT_PARTICIPANT_RECTANGLE. Each actor is modelled as a PlantUML participant with a rectangle-shape.</p>
<p>GCS4_ACT_COLOR. The actors rectangle background must be #FFF3B3</p>
<p><strong>GCS — Activation Bars (AB)</strong></p>
<p>GCS5_AB_IE_COLOR. The background of an activation bar placed just after an input event must be #C0EBFD</p>
<p>GCS6_AB_OE_COLOR. The background of an activation bar placed just after an output event must be #274364 Note: Activation bars appear only on actor lifelines; see SS2_AB_PLACEMENT_ORDERING for normative placement.</p>
</section>
<section id="naming-style-nam" class="level3">
<h3 class="anchored" data-anchor-id="naming-style-nam">4.3 Naming &amp; Style (NAM)</h3>
<p><strong>NAM — Actors (ACT)</strong></p>
<p>NAM1_ACT_INSTANCE_FORMAT. All actor instance names must be human-readable, in camelCase and prefixed with “act”. Example: actAdministrator</p>
<p>NAM2_ACT_TYPE_FORMAT. Actor type name must be human-readable, in FirstCapitalLetterFormat and prefixed by “Act”. Example 1 : ActMsrCreator Example 2 : ActEcologist</p>
<p>NAM3_ACT_DECLARATION_SYNTAX. Each actor must be modelled using this PlantUML syntax: participant “theParticipantName:ActParticipantType” as theParticipantName Example 1: participant “theCreator:ActMsrCreator” as theCreator Example 2: participant “chris:ActEcologist” as chris</p>
</section>
<section id="rule-catalog-m1" class="level3">
<h3 class="anchored" data-anchor-id="rule-catalog-m1">4.4 Rule Catalog (M1)</h3>
<p>A catalog enumerating TCS/GCS/NAM rules with: ID, Title, Syntax Pattern, Examples (✓/✗), Severity, Scope (M1), Rationale, Notes. (To be provided/maintained alongside the rules.)</p>
</section>
</section>
<section id="validation-diagnostics-and-traceability-normative" class="level2">
<h2 class="anchored" data-anchor-id="validation-diagnostics-and-traceability-normative">5. Validation, Diagnostics, and Traceability (Normative)</h2>
<section id="diagnostic-format" class="level3">
<h3 class="anchored" data-anchor-id="diagnostic-format">5.1 Diagnostic Format</h3>
<p>Every validation message MUST reference the specific rule ID and include severity and location.</p>
</section>
<section id="artifact-mapping" class="level3">
<h3 class="anchored" data-anchor-id="artifact-mapping">5.2 Artifact Mapping</h3>
<p>Each rule maps to diagnostics and generated artifacts across the pipeline; maintain a Rule→Diagnostic→Artifact trace matrix.</p>
</section>
</section>
<section id="examples-and-counter-examples-informative" class="level2">
<h2 class="anchored" data-anchor-id="examples-and-counter-examples-informative">6. Examples and Counter-examples (Informative)</h2>
<section id="minimal-valid-mucim" class="level3">
<h3 class="anchored" data-anchor-id="minimal-valid-mucim">6.1 Minimal Valid MUCIM</h3>
<pre class="plantuml"><code>@startuml
participant System as system
participant "actUser:ActUser" as actUser

actUser -&gt; system : oeLogin("john", "password123")
activate actUser
deactivate actUser

system --&gt; actUser : ieWelcomeMessage("Hello John!")
activate actUser
deactivate actUser
@enduml</code></pre>
</section>
<section id="common-violations" class="level3">
<h3 class="anchored" data-anchor-id="common-violations">6.2 Common Violations</h3>
<p>Violation AS6_ACT_NO_ACT_ACT_EVENTS (Actor→Actor):</p>
<pre class="plantuml"><code>actUser -&gt; actAdmin : oeDirectMessage("hello")  // FORBIDDEN</code></pre>
<p>Violation AS4_SYS_NO_SELF_LOOP (System self-loop):</p>
<pre class="plantuml"><code>system -&gt; system : ieInternalProcess()  // FORBIDDEN</code></pre>
<p>Violation TCS10_AB_NO_ACTIVATION_BAR_ON_SYSTEM (System activation):</p>
<pre class="plantuml"><code>activate system  // FORBIDDEN</code></pre>
</section>
</section>
<section id="glossary-informative" class="level2">
<h2 class="anchored" data-anchor-id="glossary-informative">7. Glossary (Informative)</h2>
<ul>
<li>MUCIM: Messir Use-Case Instance Model</li>
<li>System: The unique reactive system participant</li>
<li>Actor: External domain role interacting with the System</li>
<li>Output Event (OE): Actor→System message</li>
<li>Input Event (IE): System→Actor message</li>
<li>ExecutionSpecification: UML concept rendered as “activation bar”</li>
<li>Lifeline: UML participant in sequence diagram</li>
</ul>
</section>
<section id="annex-machine-readable-rule-catalog-informative" class="level2">
<h2 class="anchored" data-anchor-id="annex-machine-readable-rule-catalog-informative">8. Annex: Machine-readable Rule Catalog (Informative)</h2>
<p>Suggest providing a JSON/YAML export of Sections 3 and 4 to enable automated checks and cross-tool consumption.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>